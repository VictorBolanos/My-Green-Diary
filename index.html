<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Green Diary - Diario de Plantas</title>
    <link rel="icon" type="image/png" href="img/favicon.png">
    <link rel="stylesheet" href="styles.css">
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-storage-compat.js"></script>
</head>
<body>
    <!-- Modal de autenticaci√≥n -->
    <div id="authModal" class="modal">
        <div class="modal-content glass-panel" style="max-width: 400px;">
            <h2 style="color: var(--light-green); margin-bottom: 20px; text-align: center;">Acceso Restringido</h2>
            <p style="color: var(--text-muted); margin-bottom: 20px; text-align: center;">Por favor, introduce el PIN:</p>
            <div id="authForm">
                <!-- Display de PIN -->
                <div id="pinDisplay" class="pin-display">
                    <div class="pin-dot"></div>
                    <div class="pin-dot"></div>
                    <div class="pin-dot"></div>
                    <div class="pin-dot"></div>
                    <div class="pin-dot"></div>
                    <div class="pin-dot"></div>
                    <div class="pin-dot"></div>
                    <div class="pin-dot"></div>
                </div>
                <div id="authError" style="color: #ff6b6b; margin-bottom: 15px; text-align: center; display: none;"></div>
                <!-- Teclado PIN -->
                <div class="pin-keyboard">
                    <button type="button" class="pin-key" data-number="1">1</button>
                    <button type="button" class="pin-key" data-number="2">2</button>
                    <button type="button" class="pin-key" data-number="3">3</button>
                    <button type="button" class="pin-key" data-number="4">4</button>
                    <button type="button" class="pin-key" data-number="5">5</button>
                    <button type="button" class="pin-key" data-number="6">6</button>
                    <button type="button" class="pin-key" data-number="7">7</button>
                    <button type="button" class="pin-key" data-number="8">8</button>
                    <button type="button" class="pin-key" data-number="9">9</button>
                    <button type="button" class="pin-key pin-key-delete" id="pinDeleteBtn">‚å´</button>
                    <button type="button" class="pin-key" data-number="0">0</button>
                    <button type="button" class="pin-key pin-key-submit" id="pinSubmitBtn">‚úì</button>
                </div>
            </div>
        </div>
    </div>

    <div class="container" id="mainContent" style="display: none;">
        <!-- Header -->
        <header class="glass-panel">
            <div style="display: flex; justify-content: space-between; align-items: center; width: 100%; margin: 0; padding: 0;">
                <img src="img/My Green Diary Logo.png" alt="My Green Diary" class="header-logo">
                <button id="changeBgBtn" class="btn-action" title="Cambiar fondo de pantalla">
                    <img src="img/icons/bg-change.svg" alt="Fondo" class="btn-action-icon">
                </button>
            </div>
        </header>

        <!-- Filtros y b√∫squeda -->
        <section class="glass-panel filters-section">
            <div class="search-box" style="display: flex; gap: 10px; align-items: center;">
                <button id="openPlantModalBtn" class="btn-secondary btn-small">
                    <img src="img/icons/plus.svg" alt="Agregar" class="btn-icon">
                    Nueva Planta
                </button>
                <div style="position: relative; flex: 1;">
                    <img src="img/icons/search.svg" alt="Buscar" style="position: absolute; left: 12px; top: 50%; transform: translateY(-50%); width: 18px; height: 18px; filter: brightness(0) invert(1); opacity: 0.7; z-index: 1; pointer-events: none;">
                    <input type="text" id="searchInput" placeholder="Buscar plantas..." style="flex: 1; padding-left: 38px;">
                </div>
            </div>
            <div class="filter-buttons">
                <button class="filter-btn active" data-filter="all">Todas</button>
                <button class="filter-btn" data-filter="needs-water">Necesitan Riego</button>
                <button class="filter-btn" data-filter="recent">Recientes</button>
                <button class="filter-btn" data-filter="poor-health">Mala Salud</button>
            </div>
            <div class="advanced-filters">
                <button id="toggleFiltersBtn" class="btn-secondary btn-small">
                    <img src="img/icons/filter.svg" alt="Filtros" class="btn-icon" id="toggleFilterIcon"> Filtros Avanzados
                </button>
                <div id="advancedFiltersPanel" class="advanced-filters-panel hidden">
                    <div class="form-row-grid">
                        <div class="form-group">
                            <label for="filterSpecies">Filtrar por Especie</label>
                            <input type="text" id="filterSpecies" placeholder="Ej: Monstera">
                        </div>
                        <div class="form-group">
                            <label for="filterLight">Filtrar por Luz</label>
                            <select id="filterLight">
                                <option value="">Todas</option>
                                <option value="Sombra">Sombra</option>
                                <option value="Sombra Parcial">Sombra Parcial</option>
                                <option value="Luz Indirecta">Luz Indirecta</option>
                                <option value="Luz Directa">Luz Directa</option>
                                <option value="Luz Intensa">Luz Intensa</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="filterHumidity">Filtrar por Humedad</label>
                            <select id="filterHumidity">
                                <option value="">Todas</option>
                                <option value="BAJA (<40%)">BAJA (<40%)</option>
                                <option value="MEDIA (40-60%)">MEDIA (40-60%)</option>
                                <option value="ALTA (60-80%)">ALTA (60-80%)</option>
                                <option value="MUY ALTA (>80%)">MUY ALTA (>80%)</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="filterVariety">Filtrar por Variaci√≥n</label>
                            <input type="text" id="filterVariety" placeholder="Ej: Variegata">
                        </div>
                    </div>
                    <div style="margin-top: 15px; display: flex; gap: 10px;">
                        <button id="applyFiltersBtn" class="btn-primary btn-small">Aplicar Filtros</button>
                        <button id="clearFiltersBtn" class="btn-secondary btn-small">Limpiar Filtros</button>
                    </div>
                </div>
            </div>
        </section>

        <!-- Lista de plantas -->
        <section id="plantsContainer" class="plants-grid">
            <!-- Las plantas se agregar√°n aqu√≠ din√°micamente -->
        </section>

        <!-- Modal para nueva/editar planta -->
        <div id="plantFormModal" class="modal hidden">
            <div class="modal-content glass-panel" style="max-width: 800px;">
                <span class="close-modal" id="closePlantFormModal">&times;</span>
                <h2 id="plantFormModalTitle">Nueva Planta</h2>
                <form id="plantForm">
                    <div class="form-row-grid">
                        <div class="form-group">
                            <label for="plantName">Nombre de la Planta *</label>
                            <input type="text" id="plantName" required placeholder="Ej: Monstera Deliciosa">
                        </div>

                        <div class="form-group">
                            <label for="plantSpecies">Especie *</label>
                            <input type="text" id="plantSpecies" required placeholder="Ej: Monstera deliciosa">
                        </div>
                    </div>

                    <div class="form-row-grid">
                        <div class="form-group">
                            <label for="plantVariety">Variaci√≥n</label>
                            <input type="text" id="plantVariety" placeholder="Ej: Variegata, Albo, etc.">
                        </div>

                        <div class="form-group">
                            <label for="plantType">Tipo de Planta</label>
                            <select id="plantType">
                                <option value="">Seleccionar...</option>
                                <option value="Planta verde">Planta verde</option>
                                <option value="Trepadora">Trepadora</option>
                                <option value="Colgante">Colgante</option>
                                <option value="Suculenta">Suculenta</option>
                                <option value="Cactus">Cactus</option>
                                <option value="Planta de flor">Planta de flor</option>
                                <option value="Planta arom√°tica">Planta arom√°tica</option>
                                <option value="Planta acu√°tica">Planta acu√°tica</option>
                                <option value="Bons√°i">Bons√°i</option>
                                <option value="Palmera">Palmera</option>
                                <option value="Helecho">Helecho</option>
                                <option value="Bulbosa">Bulbosa</option>
                                <option value="Orqu√≠dea">Orqu√≠dea</option>
                                <option value="Carn√≠vora">Carn√≠vora</option>
                                <option value="Ep√≠fita">Ep√≠fita</option>
                                <option value="Tapizante">Tapizante</option>
                                <option value="Arbusto">Arbusto</option>
                                <option value="√Årbol">√Årbol</option>
                                <option value="Bamb√∫">Bamb√∫</option>
                                <option value="Planta a√©rea">Planta a√©rea</option>
                            </select>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="plantAcquisitionDate">
                            <img src="img/icons/date.svg" alt="Fecha" class="label-icon"> Fecha de Adquisici√≥n
                        </label>
                        <input type="date" id="plantAcquisitionDate">
                    </div>

                    <div class="form-group">
                        <label for="plantDescription">Descripci√≥n</label>
                        <textarea id="plantDescription" rows="3" placeholder="Descripci√≥n de la planta..."></textarea>
                    </div>

                    <div class="form-group">
                        <label for="plantPhoto">
                            <img src="img/icons/photo.svg" alt="Foto" class="label-icon"> Foto de la Planta
                        </label>
                        <div class="photo-options">
                            <div id="uploadTab" class="photo-tab-content active">
                                <input type="file" id="plantPhotoFile" accept="image/*" capture class="file-input">
                                <small>Selecciona una imagen desde tu dispositivo o haz una foto con la c√°mara</small>
                                <div id="photoPreview" class="photo-preview hidden">
                                    <img id="previewImage" src="" alt="Vista previa">
                                    <button type="button" id="removePreview" class="btn-small btn-secondary">Eliminar</button>
                                </div>
                            </div>
                        </div>
                        <small style="margin-top: 10px; display: block;">Si no seleccionas ninguna, se usar√° una imagen por defecto</small>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="plantLight">
                                <img src="img/icons/sun.svg" alt="Luz" class="label-icon"> Luz Requerida
                            </label>
                            <select id="plantLight">
                                <option value="">Seleccionar...</option>
                                <option value="Sombra">Sombra</option>
                                <option value="Sombra Parcial">Sombra Parcial</option>
                                <option value="Luz Indirecta">Luz Indirecta</option>
                                <option value="Luz Directa">Luz Directa</option>
                                <option value="Luz Intensa">Luz Intensa</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label for="plantTemperature">
                                <img src="img/icons/temperature.svg" alt="Temperatura" class="label-icon"> Temperatura (¬∞C)
                            </label>
                            <input type="text" id="plantTemperature" placeholder="Ej: 18-24¬∞C">
                        </div>

                        <div class="form-group">
                            <label for="plantHumidity">
                                <img src="img/icons/humidity.svg" alt="Humedad" class="label-icon"> Humedad
                            </label>
                            <select id="plantHumidity">
                                <option value="">Seleccionar...</option>
                                <option value="BAJA (<40%)">BAJA (<40%)</option>
                                <option value="MEDIA (40-60%)">MEDIA (40-60%)</option>
                                <option value="ALTA (60-80%)">ALTA (60-80%)</option>
                                <option value="MUY ALTA (>80%)">MUY ALTA (>80%)</option>
                            </select>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="plantSubstrate">
                            <img src="img/icons/plant.svg" alt="Sustrato" class="label-icon"> Mezcla de Sustrato
                        </label>
                        <div id="substrateSelector" class="substrate-selector">
                            <div class="substrate-controls">
                                <div class="substrate-list" id="substrateList"></div>
                                <div class="substrate-chart-container">
                                    <div class="substrate-chart-label">Mezcla Actual</div>
                                    <svg id="substrateChart" class="substrate-chart" viewBox="0 0 200 200" xmlns="http://www.w3.org/2000/svg">
                                        <defs>
                                            <filter id="shadow">
                                                <feDropShadow dx="0" dy="2" stdDeviation="3" flood-opacity="0.3"/>
                                            </filter>
                                        </defs>
                                        <text x="100" y="105" text-anchor="middle" dominant-baseline="middle" 
                                              fill="var(--text-light)" font-size="24" font-weight="700" 
                                              style="filter: drop-shadow(0 2px 4px rgba(0,0,0,0.3));">0%</text>
                                    </svg>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="form-group">
                        <label>
                            <img src="img/icons/water-drop.svg" alt="Riego" class="label-icon"> Frecuencia de Riego por Estaci√≥n (D√≠as)
                        </label>
                        <div class="form-row-grid">
                            <div class="form-group">
                                <label for="plantWateringSpring">Primavera</label>
                                <input type="text" id="plantWateringSpring" placeholder="Ej: Cada 5-7 d√≠as">
                            </div>
                            <div class="form-group">
                                <label for="plantWateringSummer">Verano</label>
                                <input type="text" id="plantWateringSummer" placeholder="Ej: Cada 3-5 d√≠as">
                            </div>
                            <div class="form-group">
                                <label for="plantWateringAutumn">Oto√±o</label>
                                <input type="text" id="plantWateringAutumn" placeholder="Ej: Cada 7-10 d√≠as">
                            </div>
                            <div class="form-group">
                                <label for="plantWateringWinter">Invierno</label>
                                <input type="text" id="plantWateringWinter" placeholder="Ej: Cada 10-14 d√≠as">
                            </div>
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="switch-label">
                            <img src="img/icons/warning.svg" alt="Advertencia" class="label-icon">
                            <span>Planta en mala salud</span>
                            <label class="switch">
                                <input type="checkbox" id="plantPoorHealth">
                                <span class="slider"></span>
                            </label>
                        </label>
                    </div>

                    <div class="form-group">
                        <label for="plantDiseases">
                            <img src="img/icons/virus.svg" alt="Enfermedades" class="label-icon"> Enfermedades/Plagas
                        </label>
                        <div class="dual-list-selector">
                            <div class="dual-list-box">
                                <div class="dual-list-label">Disponibles</div>
                                <select id="plantDiseasesAvailable" multiple size="10" class="dual-list-select">
                                    <option value="Cochinilla algodonosa">Cochinilla algodonosa</option>
                                    <option value="Pulg√≥n">Pulg√≥n</option>
                                    <option value="Ara√±a roja">Ara√±a roja</option>
                                    <option value="Trips">Trips</option>
                                    <option value="Mosca del sustrato (sci√°ridos)">Mosca del sustrato (sci√°ridos)</option>
                                    <option value="Mosca blanca">Mosca blanca</option>
                                    <option value="Hormigas">Hormigas</option>
                                    <option value="Caracoles/babosas (exterior)">Caracoles/babosas (exterior)</option>
                                    <option value="Orugas (exterior)">Orugas (exterior)</option>
                                    <option value="Nematodos">Nematodos</option>
                                    <option value="O√≠dio">O√≠dio</option>
                                    <option value="Mildiu">Mildiu</option>
                                    <option value="Negrilla/fumagina">Negrilla/fumagina</option>
                                    <option value="Podredumbre radicular">Podredumbre radicular</option>
                                    <option value="Roya">Roya</option>
                                </select>
                            </div>
                            <div class="dual-list-buttons">
                                <button type="button" class="dual-list-btn" id="addDiseaseBtn" title="A√±adir seleccionadas">
                                    <img src="img/icons/plus.svg" alt="A√±adir" class="dual-list-btn-icon">
                                </button>
                                <button type="button" class="dual-list-btn" id="removeDiseaseBtn" title="Quitar seleccionadas">
                                    <img src="img/icons/minus.svg" alt="Quitar" class="dual-list-btn-icon">
                                </button>
                            </div>
                            <div class="dual-list-box">
                                <div class="dual-list-label">Seleccionadas</div>
                                <select id="plantDiseasesSelected" multiple size="10" class="dual-list-select">
                                </select>
                            </div>
                        </div>
                    </div>

                    <div class="form-actions">
                        <button type="submit" class="btn-primary">
                            <img src="img/icons/save.svg" alt="Guardar" class="btn-icon"> Guardar Planta
                        </button>
                        <button type="button" id="cancelFormBtn" class="btn-secondary">
                            <img src="img/icons/cancel.svg" alt="Cancelar" class="btn-icon"> Cancelar
                        </button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Modal para editar/ver detalles -->
        <div id="plantModal" class="modal hidden">
            <div class="modal-content glass-panel plant-modal-content">
                <span class="close-modal">&times;</span>
                <div id="modalBody">
                    <!-- Contenido din√°mico -->
                </div>
            </div>
        </div>

        <!-- Modal para leyenda de sustratos -->
        <div id="substrateLegendModal" class="modal hidden">
            <div class="modal-content glass-panel substrate-legend-modal-content">
                <h2 style="color: var(--light-green); margin-bottom: 20px;">Leyenda de Sustratos</h2>
                <div id="substrateLegendList" class="substrate-legend-list"></div>
            </div>
        </div>

        <!-- Modal para cambiar fondo -->
        <div id="bgModal" class="modal hidden">
            <div class="modal-content glass-panel bg-modal-content">
                <span class="close-modal close-bg-modal">&times;</span>
                <h2 style="margin-bottom: 20px; color: var(--light-green);">üé® Cambiar Fondo de Pantalla</h2>
                <div class="bg-options">
                    <div class="bg-option" data-bg="palm-tree-leaves">
                        <img src="img/bgs/palm-tree-leaves.jpg" alt="Palmeras">
                        <p>Palmeras</p>
                        <span class="bg-check">‚úì</span>
                    </div>
                    <div class="bg-option" data-bg="leaves-close-up">
                        <img src="img/bgs/leaves-close-up.jpg" alt="Hojas Cercanas">
                        <p>Hojas Cercanas</p>
                        <span class="bg-check">‚úì</span>
                    </div>
                    <div class="bg-option" data-bg="leaves-red-fruits">
                        <img src="img/bgs/leaves-red-fruits.jpg" alt="Hojas y Frutos">
                        <p>Hojas y Frutos</p>
                        <span class="bg-check">‚úì</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Firebase Config (completa tus credenciales aqu√≠) -->
    <script src="firebase-config.js"></script>
    
    <script src="script.js"></script>
</body>
</html>
